{% extends "base.html" %} {% block title %}ç”¨æˆ·ç®¡ç† | ç³»ç»Ÿæ§åˆ¶å°{% endblock %}
{% block content %}
<div class="admin-container">
  <!-- é¡¶éƒ¨ç®¡ç†å‘˜ä¿¡æ¯åŒºåŸŸ -->
  <div class="admin-header">
    <div class="admin-header-content">
      <div class="admin-title-section">
        <h1 class="admin-title">
          <span class="admin-icon">ğŸ‘¥</span>
          ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ
        </h1>
        <p class="admin-subtitle">å®‰å…¨é«˜æ•ˆçš„ç”¨æˆ·ç®¡ç†ä¸æƒé™æ§åˆ¶</p>
      </div>
      <div class="admin-info-card" id="adminInfo">
        <div class="admin-info-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </div>
        <div class="admin-info-text">
          <p class="admin-info-label">å½“å‰ç®¡ç†å‘˜</p>
          <p class="admin-info-value" id="adminInfoText">åŠ è½½ç®¡ç†å‘˜ä¿¡æ¯ä¸­...</p>
        </div>
      </div>
    </div>

    <!-- ç»Ÿè®¡å¡ç‰‡åŒºåŸŸ -->
    <div class="admin-stats">
      <div class="stat-card">
        <div class="stat-icon user-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
        </div>
        <div class="stat-content">
          <h3 class="stat-value" id="totalUsers">--</h3>
          <p class="stat-label">æ€»ç”¨æˆ·æ•°</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon admin-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="8.5" cy="7" r="4"></circle>
            <path d="M20 8v6"></path>
            <path d="M23 11h-6"></path>
          </svg>
        </div>
        <div class="stat-content">
          <h3 class="stat-value" id="adminUsers">--</h3>
          <p class="stat-label">ç®¡ç†å‘˜æ•°</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon security-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
          </svg>
        </div>
        <div class="stat-content">
          <h3 class="stat-value" id="activeSessions">--</h3>
          <p class="stat-label">æ´»è·ƒä¼šè¯</p>
        </div>
      </div>
    </div>
  </div>

  <div class="admin-content">
    <!-- å·¦ä¾§ç”¨æˆ·åˆ—è¡¨åŒºåŸŸ -->
    <div class="admin-main-section">
      <div class="section-card">
        <div class="section-header">
          <h2 class="section-title">
            <span class="section-icon">ğŸ“‹</span>
            ç”¨æˆ·åˆ—è¡¨
          </h2>
          <div class="section-actions">
            <button class="btn-refresh" id="refreshUsers" title="åˆ·æ–°åˆ—è¡¨">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M23 4v6h-6"></path>
                <path d="M1 20v-6h6"></path>
                <path
                  d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"
                ></path>
              </svg>
            </button>
            <div class="search-box">
              <input
                type="text"
                id="userSearch"
                placeholder="æœç´¢ç”¨æˆ·..."
                class="search-input"
              />
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="search-icon"
              >
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
            </div>
          </div>
        </div>

        <div class="table-container">
          <table class="modern-table" id="userTable">
            <thead>
              <tr>
                <th class="sortable" data-sort="id">
                  ID <span class="sort-icon">â†•</span>
                </th>
                <th class="sortable" data-sort="username">
                  ç”¨æˆ·å <span class="sort-icon">â†•</span>
                </th>
                <th class="sortable" data-sort="role">
                  è§’è‰² <span class="sort-icon">â†•</span>
                </th>
                <th>çŠ¶æ€</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="userTableBody">
              <!-- ç”¨æˆ·æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
              <tr class="loading-row">
                <td colspan="5">
                  <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>æ­£åœ¨åŠ è½½ç”¨æˆ·æ•°æ®...</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="table-footer">
          <div class="table-summary">
            æ˜¾ç¤º <span id="shownUsers">0</span> ä¸ªç”¨æˆ·ï¼Œå…±
            <span id="totalUsersCount">0</span> ä¸ª
          </div>
          <div class="pagination" id="userPagination">
            <!-- åˆ†é¡µå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
          </div>
        </div>
      </div>
    </div>

    <!-- å³ä¾§æ“ä½œé¢æ¿ -->
    <div class="admin-sidebar">
      <!-- æ·»åŠ ç”¨æˆ·å¡ç‰‡ -->
      <div class="section-card">
        <div class="section-header">
          <h2 class="section-title">
            <span class="section-icon">â•</span>
            æ·»åŠ æ–°ç”¨æˆ·
          </h2>
        </div>

        <form id="addUserForm" class="user-form">
          <div class="form-group">
            <label for="newUsername" class="form-label">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
              ç”¨æˆ·å
            </label>
            <input
              type="text"
              class="form-input"
              id="newUsername"
              name="newUsername"
              required
              placeholder="è¾“å…¥æ–°ç”¨æˆ·å"
            />
            <div class="form-hint">ç”¨æˆ·åå¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œé•¿åº¦3-20ä¸ªå­—ç¬¦</div>
          </div>

          <div class="form-group">
            <label for="newPassword" class="form-label">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
              </svg>
              å¯†ç 
            </label>
            <div class="password-input-container">
              <input
                type="password"
                class="form-input"
                id="newPassword"
                name="newPassword"
                required
                placeholder="è¾“å…¥å¯†ç "
              />
              <button type="button" class="password-toggle" id="togglePassword">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="eye-icon"
                >
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              </button>
            </div>
            <div class="form-hint">
              å¯†ç é•¿åº¦è‡³å°‘6ä½ï¼Œå»ºè®®åŒ…å«å­—æ¯ã€æ•°å­—å’Œç¬¦å·
            </div>
          </div>

          <div class="form-group">
            <label for="newRole" class="form-label">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                <path d="M2 17l10 5 10-5"></path>
                <path d="M2 12l10 5 10-5"></path>
              </svg>
              è§’è‰²
            </label>
            <div class="role-selector">
              <div class="role-option" data-value="user">
                <div class="role-icon user-role-icon">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                </div>
                <div class="role-info">
                  <div class="role-name">æ™®é€šç”¨æˆ·</div>
                  <div class="role-desc">åŸºç¡€ç³»ç»Ÿè®¿é—®æƒé™</div>
                </div>
                <div class="role-check"></div>
              </div>

              <div class="role-option" data-value="admin">
                <div class="role-icon admin-role-icon">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path
                      d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"
                    ></path>
                  </svg>
                </div>
                <div class="role-info">
                  <div class="role-name">ç®¡ç†å‘˜</div>
                  <div class="role-desc">å®Œå…¨ç³»ç»Ÿæ§åˆ¶æƒé™</div>
                </div>
                <div class="role-check"></div>
              </div>
            </div>
            <input type="hidden" id="newRole" name="newRole" value="user" />
          </div>

          <button type="submit" class="btn-submit" id="addUserBtn">
            <span class="btn-text">æ·»åŠ ç”¨æˆ·</span>
            <span class="btn-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </span>
          </button>
        </form>

        <div class="form-info">
          <h4 class="info-title">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="16" x2="12" y2="12"></line>
              <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
            æ“ä½œè¯´æ˜
          </h4>
          <ul class="info-list">
            <li>åªæœ‰ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ­¤é¡µé¢</li>
            <li>å¯ä»¥åˆ é™¤é™¤è‡ªå·±ä»¥å¤–çš„å…¶ä»–ç”¨æˆ·</li>
            <li>æ·»åŠ æ–°ç”¨æˆ·æ—¶ä¼šè‡ªåŠ¨åŠ å¯†å¯†ç </li>
            <li>ç”¨æˆ·åå¿…é¡»æ˜¯å”¯ä¸€çš„</li>
            <li>ç®¡ç†å‘˜æ‹¥æœ‰ç³»ç»Ÿå®Œå…¨æ§åˆ¶æƒé™</li>
          </ul>
        </div>
      </div>

      <!-- å¿«é€Ÿæ“ä½œå¡ç‰‡ -->
      <div class="section-card quick-actions">
        <div class="section-header">
          <h2 class="section-title">
            <span class="section-icon">âš¡</span>
            å¿«é€Ÿæ“ä½œ
          </h2>
        </div>

        <div class="action-buttons">
          <a href="{{ url_for('index') }}" class="action-btn home-btn">
            <div class="action-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
              </svg>
            </div>
            <div class="action-content">
              <div class="action-title">è¿”å›ä¸»é¡µ</div>
              <div class="action-desc">å®Œæˆç”¨æˆ·ç®¡ç†åè¿”å›ç³»ç»Ÿä¸»é¡µ</div>
            </div>
          </a>

          <button class="action-btn export-btn" id="exportUsers">
            <div class="action-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
            </div>
            <div class="action-content">
              <div class="action-title">å¯¼å‡ºç”¨æˆ·</div>
              <div class="action-desc">å¯¼å‡ºç”¨æˆ·åˆ—è¡¨ä¸ºCSVæ–‡ä»¶</div>
            </div>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- åˆ é™¤ç”¨æˆ·ç¡®è®¤æ¨¡æ€æ¡† -->
<div class="modal-overlay" id="deleteModal">
  <div class="modal-container">
    <div class="modal-header">
      <h3 class="modal-title">ç¡®è®¤åˆ é™¤ç”¨æˆ·</h3>
      <button class="modal-close" id="closeDeleteModal">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="modal-icon warning-icon">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="48"
          height="48"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path
            d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"
          ></path>
          <line x1="12" y1="9" x2="12" y2="13"></line>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
      </div>
      <p class="modal-text" id="deleteModalText">
        ç¡®å®šè¦åˆ é™¤ç”¨æˆ·å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚
      </p>
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" id="cancelDelete">å–æ¶ˆ</button>
      <button class="btn-confirm" id="confirmDelete">ç¡®è®¤åˆ é™¤</button>
    </div>
  </div>
</div>
{% endblock %} {% block extra_css %}
<style>
  /* ç°ä»£åŒ–ç”¨æˆ·ç®¡ç†ç•Œé¢æ ·å¼ */
  :root {
    --primary-color: #4361ee;
    --primary-dark: #3a56d4;
    --secondary-color: #7209b7;
    --success-color: #06d6a0;
    --danger-color: #ef476f;
    --warning-color: #ffd166;
    --info-color: #118ab2;
    --light-color: #f8f9fa;
    --dark-color: #212529;
    --gray-100: #f8f9fa;
    --gray-200: #e9ecef;
    --gray-300: #dee2e6;
    --gray-400: #ced4da;
    --gray-500: #adb5bd;
    --gray-600: #6c757d;
    --gray-700: #495057;
    --gray-800: #343a40;
    --gray-900: #212529;
    --border-radius: 12px;
    --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    --hover-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
    --transition: all 0.3s ease;
  }

  .admin-container {
    padding: 24px;
    max-width: 1400px;
    margin: 0 auto;
    font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, sans-serif;
  }

  /* é¡¶éƒ¨åŒºåŸŸ */
  .admin-header {
    margin-bottom: 30px;
  }

  .admin-header-content {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 30px;
  }

  .admin-title-section {
    flex: 1;
  }

  .admin-title {
    font-size: 32px;
    font-weight: 700;
    color: var(--dark-color);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .admin-icon {
    font-size: 36px;
  }

  .admin-subtitle {
    font-size: 16px;
    color: var(--gray-600);
    font-weight: 400;
  }

  .admin-info-card {
    background: linear-gradient(
      135deg,
      var(--primary-color),
      var(--secondary-color)
    );
    border-radius: var(--border-radius);
    padding: 20px 24px;
    color: white;
    display: flex;
    align-items: center;
    gap: 16px;
    box-shadow: var(--card-shadow);
    min-width: 300px;
  }

  .admin-info-icon {
    background-color: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .admin-info-text {
    flex: 1;
  }

  .admin-info-label {
    font-size: 14px;
    opacity: 0.9;
    margin-bottom: 4px;
  }

  .admin-info-value {
    font-size: 18px;
    font-weight: 600;
  }

  /* ç»Ÿè®¡å¡ç‰‡ */
  .admin-stats {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: 20px;
  }

  .stat-card {
    background-color: white;
    border-radius: var(--border-radius);
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 16px;
    box-shadow: var(--card-shadow);
    transition: var(--transition);
    border: 1px solid var(--gray-200);
  }

  .stat-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--hover-shadow);
  }

  .stat-icon {
    width: 56px;
    height: 56px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .user-icon {
    background-color: rgba(67, 97, 238, 0.1);
    color: var(--primary-color);
  }

  .admin-icon {
    background-color: rgba(114, 9, 183, 0.1);
    color: var(--secondary-color);
  }

  .security-icon {
    background-color: rgba(6, 214, 160, 0.1);
    color: var(--success-color);
  }

  .stat-content {
    flex: 1;
  }

  .stat-value {
    font-size: 28px;
    font-weight: 700;
    color: var(--dark-color);
    margin-bottom: 4px;
    line-height: 1;
  }

  .stat-label {
    font-size: 14px;
    color: var(--gray-600);
  }

  /* ä¸»è¦å†…å®¹åŒºåŸŸ */
  .admin-content {
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: 24px;
  }

  @media (max-width: 1200px) {
    .admin-content {
      grid-template-columns: 1fr;
    }
  }

  /* å¡ç‰‡é€šç”¨æ ·å¼ */
  .section-card {
    background-color: white;
    border-radius: var(--border-radius);
    box-shadow: var(--card-shadow);
    border: 1px solid var(--gray-200);
    overflow: hidden;
    margin-bottom: 24px;
  }

  .section-header {
    padding: 20px 24px;
    border-bottom: 1px solid var(--gray-200);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .section-title {
    font-size: 20px;
    font-weight: 600;
    color: var(--dark-color);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .section-icon {
    font-size: 20px;
  }

  .section-actions {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .btn-refresh {
    background-color: var(--gray-100);
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--gray-700);
    cursor: pointer;
    transition: var(--transition);
  }

  .btn-refresh:hover {
    background-color: var(--primary-color);
    color: white;
    transform: rotate(90deg);
  }

  .search-box {
    position: relative;
  }

  .search-input {
    padding: 10px 16px 10px 40px;
    border-radius: 30px;
    border: 1px solid var(--gray-300);
    font-size: 14px;
    width: 200px;
    transition: var(--transition);
  }

  .search-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
  }

  .search-icon {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray-500);
  }

  /* è¡¨æ ¼æ ·å¼ */
  .table-container {
    overflow-x: auto;
    padding: 0 24px;
  }

  .modern-table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
  }

  .modern-table thead {
    background-color: var(--gray-100);
  }

  .modern-table th {
    padding: 16px 12px;
    text-align: left;
    font-weight: 600;
    color: var(--gray-700);
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 2px solid var(--gray-300);
    white-space: nowrap;
  }

  .modern-table td {
    padding: 18px 12px;
    border-bottom: 1px solid var(--gray-200);
    color: var(--gray-800);
    font-size: 15px;
  }

  .modern-table tbody tr {
    transition: var(--transition);
  }

  .modern-table tbody tr:hover {
    background-color: rgba(67, 97, 238, 0.03);
  }

  .sortable {
    cursor: pointer;
    user-select: none;
  }

  .sort-icon {
    display: inline-block;
    margin-left: 4px;
    font-size: 12px;
  }

  .loading-row td {
    padding: 60px 20px;
    text-align: center;
  }

  .loading-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
  }

  .loading-spinner {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: 4px solid var(--gray-200);
    border-top-color: var(--primary-color);
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  .table-footer {
    padding: 20px 24px;
    border-top: 1px solid var(--gray-200);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .table-summary {
    font-size: 14px;
    color: var(--gray-600);
  }

  .pagination {
    display: flex;
    gap: 8px;
  }

  .page-btn {
    padding: 8px 14px;
    border-radius: 6px;
    border: 1px solid var(--gray-300);
    background-color: white;
    color: var(--gray-700);
    font-size: 14px;
    cursor: pointer;
    transition: var(--transition);
  }

  .page-btn:hover:not(.active):not(:disabled) {
    background-color: var(--gray-100);
  }

  .page-btn.active {
    background-color: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
  }

  .page-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* ç”¨æˆ·æ ‡ç­¾æ ·å¼ */
  .user-badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }

  .badge-user {
    background-color: rgba(67, 97, 238, 0.1);
    color: var(--primary-color);
  }

  .badge-admin {
    background-color: rgba(239, 71, 111, 0.1);
    color: var(--danger-color);
  }

  .badge-current {
    background-color: rgba(6, 214, 160, 0.1);
    color: var(--success-color);
  }

  /* æ“ä½œæŒ‰é’® */
  .table-actions {
    display: flex;
    gap: 8px;
  }

  .btn-action {
    padding: 6px 12px;
    border-radius: 6px;
    border: none;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .btn-edit {
    background-color: rgba(255, 209, 102, 0.1);
    color: var(--warning-color);
  }

  .btn-edit:hover {
    background-color: rgba(255, 209, 102, 0.2);
  }

  .btn-delete {
    background-color: rgba(239, 71, 111, 0.1);
    color: var(--danger-color);
  }

  .btn-delete:hover {
    background-color: rgba(239, 71, 111, 0.2);
  }

  /* è¡¨å•æ ·å¼ */
  .user-form {
    padding: 24px;
  }

  .form-group {
    margin-bottom: 24px;
  }

  .form-label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: 8px;
  }

  .form-input {
    width: 100%;
    padding: 14px 16px;
    border-radius: 8px;
    border: 1px solid var(--gray-300);
    font-size: 15px;
    transition: var(--transition);
  }

  .form-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
  }

  .form-hint {
    font-size: 13px;
    color: var(--gray-500);
    margin-top: 6px;
  }

  .password-input-container {
    position: relative;
  }

  .password-toggle {
    position: absolute;
    right: 14px;
    top: 50%;
    transform: translateY(-50%);
    background: transparent;
    border: none;
    color: var(--gray-500);
    cursor: pointer;
    padding: 4px;
  }

  .password-toggle:hover {
    color: var(--gray-700);
  }

  /* è§’è‰²é€‰æ‹©å™¨ */
  .role-selector {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 8px;
  }

  .role-option {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 16px;
    border-radius: 8px;
    border: 2px solid var(--gray-200);
    cursor: pointer;
    transition: var(--transition);
    position: relative;
  }

  .role-option:hover {
    border-color: var(--primary-color);
  }

  .role-option.selected {
    border-color: var(--primary-color);
    background-color: rgba(67, 97, 238, 0.03);
  }

  .role-icon {
    width: 48px;
    height: 48px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .user-role-icon {
    background-color: rgba(67, 97, 238, 0.1);
    color: var(--primary-color);
  }

  .admin-role-icon {
    background-color: rgba(239, 71, 111, 0.1);
    color: var(--danger-color);
  }

  .role-info {
    flex: 1;
  }

  .role-name {
    font-weight: 600;
    color: var(--dark-color);
    margin-bottom: 2px;
  }

  .role-desc {
    font-size: 13px;
    color: var(--gray-600);
  }

  .role-check {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 2px solid var(--gray-300);
    transition: var(--transition);
  }

  .role-option.selected .role-check {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
    position: relative;
  }

  .role-option.selected .role-check::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 10px;
    height: 10px;
    background-color: white;
    border-radius: 50%;
  }

  /* æäº¤æŒ‰é’® */
  .btn-submit {
    width: 100%;
    padding: 16px;
    background: linear-gradient(
      135deg,
      var(--primary-color),
      var(--secondary-color)
    );
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-top: 10px;
  }

  .btn-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(67, 97, 238, 0.2);
  }

  .btn-submit:active {
    transform: translateY(0);
  }

  .btn-submit:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
  }

  /* ä¿¡æ¯åŒºåŸŸ */
  .form-info {
    padding: 0 24px 24px;
  }

  .info-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .info-list {
    list-style-type: none;
    padding-left: 0;
  }

  .info-list li {
    padding: 8px 0;
    color: var(--gray-600);
    font-size: 14px;
    position: relative;
    padding-left: 24px;
  }

  .info-list li::before {
    content: "â€¢";
    color: var(--primary-color);
    font-weight: bold;
    position: absolute;
    left: 0;
  }

  /* å¿«é€Ÿæ“ä½œ */
  .quick-actions {
    padding: 24px;
  }

  .action-buttons {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .action-btn {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 18px;
    border-radius: 10px;
    border: 1px solid var(--gray-200);
    background-color: white;
    text-decoration: none;
    transition: var(--transition);
    cursor: pointer;
  }

  .action-btn:hover {
    transform: translateY(-3px);
    box-shadow: var(--hover-shadow);
    border-color: var(--primary-color);
  }

  .action-icon {
    width: 48px;
    height: 48px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--gray-100);
  }

  .home-btn .action-icon {
    background-color: rgba(67, 97, 238, 0.1);
    color: var(--primary-color);
  }

  .export-btn .action-icon {
    background-color: rgba(6, 214, 160, 0.1);
    color: var(--success-color);
  }

  .action-content {
    flex: 1;
  }

  .action-title {
    font-weight: 600;
    color: var(--dark-color);
    margin-bottom: 4px;
  }

  .action-desc {
    font-size: 13px;
    color: var(--gray-600);
  }

  /* æ¨¡æ€æ¡† */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: var(--transition);
  }

  .modal-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  .modal-container {
    background-color: white;
    border-radius: var(--border-radius);
    width: 90%;
    max-width: 500px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
    overflow: hidden;
    transform: translateY(20px);
    transition: var(--transition);
  }

  .modal-overlay.active .modal-container {
    transform: translateY(0);
  }

  .modal-header {
    padding: 24px;
    border-bottom: 1px solid var(--gray-200);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .modal-title {
    font-size: 20px;
    font-weight: 600;
    color: var(--dark-color);
  }

  .modal-close {
    background: transparent;
    border: none;
    color: var(--gray-500);
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-close:hover {
    background-color: var(--gray-100);
    color: var(--gray-700);
  }

  .modal-body {
    padding: 32px 24px;
    text-align: center;
  }

  .modal-icon {
    margin-bottom: 20px;
  }

  .warning-icon {
    color: var(--danger-color);
  }

  .modal-text {
    font-size: 16px;
    color: var(--gray-700);
    line-height: 1.6;
  }

  .modal-footer {
    padding: 20px 24px;
    border-top: 1px solid var(--gray-200);
    display: flex;
    justify-content: flex-end;
    gap: 12px;
  }

  .btn-cancel,
  .btn-confirm {
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 15px;
    font-weight: 500;
    cursor: pointer;
    transition: var(--transition);
    border: none;
  }

  .btn-cancel {
    background-color: var(--gray-100);
    color: var(--gray-700);
  }

  .btn-cancel:hover {
    background-color: var(--gray-200);
  }

  .btn-confirm {
    background-color: var(--danger-color);
    color: white;
  }

  .btn-confirm:hover {
    background-color: #e63946;
  }

  /* å“åº”å¼è°ƒæ•´ */
  @media (max-width: 768px) {
    .admin-container {
      padding: 16px;
    }

    .admin-header-content {
      flex-direction: column;
      gap: 20px;
    }

    .admin-info-card {
      width: 100%;
      min-width: auto;
    }

    .admin-stats {
      grid-template-columns: 1fr;
    }

    .section-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 16px;
    }

    .section-actions {
      width: 100%;
    }

    .search-input {
      width: 100%;
    }

    .table-footer {
      flex-direction: column;
      gap: 16px;
      align-items: flex-start;
    }
  }

  /* ç”¨æˆ·çŠ¶æ€æŒ‡ç¤ºå™¨ */
  .user-status {
    display: inline-block;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    margin-right: 8px;
  }

  .status-active {
    background-color: var(--success-color);
    box-shadow: 0 0 0 3px rgba(6, 214, 160, 0.2);
  }

  .status-inactive {
    background-color: var(--gray-400);
  }

  /* ç©ºçŠ¶æ€ */
  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--gray-500);
  }

  .empty-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
  }

  /* æˆåŠŸ/é”™è¯¯æç¤º */
  .notification {
    position: fixed;
    top: 24px;
    right: 24px;
    padding: 16px 24px;
    border-radius: 8px;
    color: white;
    font-weight: 500;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    z-index: 9999;
    transform: translateX(400px);
    transition: transform 0.4s ease;
    max-width: 400px;
  }

  .notification.show {
    transform: translateX(0);
  }

  .notification.success {
    background-color: var(--success-color);
  }

  .notification.error {
    background-color: var(--danger-color);
  }

  .notification.info {
    background-color: var(--info-color);
  }
</style>
{% endblock %} {% block extra_js %}
<script>
  /* ================== å…¨å±€çŠ¶æ€ ================== */
  let currentPage = 1;
  let pageSize = 10;
  let totalUsers = 0;

  // é»˜è®¤æ’åºï¼šä»å°åˆ°å¤§
  let currentSortBy = "id";
  let currentSortOrder = "asc";

  let currentSearch = "";
  let userToDelete = null;

  /* ================== é¡µé¢åˆå§‹åŒ– ================== */
  document.addEventListener("DOMContentLoaded", () => {
    const currentUser = JSON.parse(sessionStorage.getItem("currentUser"));

    if (!currentUser) {
      window.location.href = "{{ url_for('login_page') }}";
      return;
    }

    if (currentUser.role !== "admin") {
      showNotification("åªæœ‰ç®¡ç†å‘˜å¯ä»¥è®¿é—®è¯¥é¡µé¢", "error");
      setTimeout(() => {
        window.location.href = "{{ url_for('index') }}";
      }, 1500);
      return;
    }

    // æ˜¾ç¤ºç®¡ç†å‘˜ä¿¡æ¯
    document.getElementById(
      "adminInfoText"
    ).innerHTML = `<strong>${currentUser.username}</strong> | ç®¡ç†å‘˜`;

    loadStats();
    loadUsers();
    bindEvents();

    // é»˜è®¤é€‰ä¸­æ™®é€šç”¨æˆ·
    const defaultRole = document.querySelector(
      '.role-option[data-value="user"]'
    );
    if (defaultRole) {
      defaultRole.classList.add("selected");
      document.getElementById("newRole").value = "user";
    }
  });

  /* ================== ç»Ÿè®¡ä¿¡æ¯ ================== */
  async function loadStats() {
    try {
      const res = await fetch("/api/user/stats");
      const data = await res.json();

      if (data.success) {
        document.getElementById("totalUsers").textContent =
          data.data.total_users || 0;
        document.getElementById("adminUsers").textContent =
          data.data.admin_users || 0;
        document.getElementById("activeSessions").textContent =
          data.data.active_sessions || 0;
      } else {
        window.location.reload();
      }
    } catch (e) {
      window.location.reload();
    }
  }

  /* ================== ç”¨æˆ·åˆ—è¡¨ ================== */
  async function loadUsers() {
    const tbody = document.getElementById("userTableBody");
    tbody.innerHTML = `
    <tr>
      <td colspan="5" style="text-align:center;">åŠ è½½ä¸­...</td>
    </tr>`;

    const params = new URLSearchParams({
      page: currentPage,
      page_size: pageSize,
      search: currentSearch,
      sort_by: currentSortBy,
      sort_order: currentSortOrder,
    });

    try {
      const res = await fetch(`/api/user/list?${params.toString()}`);
      const data = await res.json();

      renderUserTable(data.data.users);
      renderPagination(data.data.total);
    } catch (e) {
      window.location.reload();
    }
  }

  /* ================== è¡¨æ ¼æ¸²æŸ“ ================== */
  function renderUserTable(users) {
    const tbody = document.getElementById("userTableBody");
    tbody.innerHTML = "";

    if (!users || users.length === 0) {
      tbody.innerHTML = `
      <tr>
        <td colspan="5" style="text-align:center;">æš‚æ— æ•°æ®</td>
      </tr>`;
      return;
    }

    users.forEach((user) => {
      const roleText = user.role === "admin" ? "ç®¡ç†å‘˜" : "ç”¨æˆ·";

      tbody.innerHTML += `
      <tr>
        <td>${user.id}</td>
        <td>${user.username}</td>
        <td>${roleText}</td>
        <td>æ­£å¸¸</td>
        <td>
          <button class="btn-action btn-delete"
            onclick="openDeleteModal('${user.username}')">
            åˆ é™¤
          </button>
        </td>
      </tr>`;
    });

    document.getElementById("shownUsers").textContent = users.length;
  }

  /* ================== åˆ†é¡µ ================== */
  function renderPagination(total) {
    totalUsers = total;
    document.getElementById("totalUsersCount").textContent = total;

    const totalPages = Math.ceil(total / pageSize);
    const pagination = document.getElementById("userPagination");
    pagination.innerHTML = "";

    if (totalPages <= 1) return;

    for (let i = 1; i <= totalPages; i++) {
      const btn = document.createElement("button");
      btn.textContent = i;
      btn.className = "page-btn" + (i === currentPage ? " active" : "");
      btn.onclick = () => {
        currentPage = i;
        loadUsers();
      };
      pagination.appendChild(btn);
    }
  }

  /* ================== æ’åºï¼ˆå‡/é™åˆ‡æ¢ï¼‰ ================== */
  function sortTable(field) {
    if (currentSortBy === field) {
      currentSortOrder = currentSortOrder === "asc" ? "desc" : "asc";
    } else {
      currentSortBy = field;
      currentSortOrder = "asc";
    }
    loadUsers();
  }

  /* ================== æœç´¢ / åˆ·æ–° ================== */
  function bindEvents() {
    document.getElementById("refreshUsers").onclick = () => loadUsers();

    document.getElementById("userSearch").addEventListener(
      "input",
      debounce((e) => {
        currentSearch = e.target.value.trim();
        currentPage = 1;
        loadUsers();
      }, 300)
    );

    document.getElementById("closeDeleteModal").onclick = closeDeleteModal;
    document.getElementById("cancelDelete").onclick = closeDeleteModal;
    document.getElementById("confirmDelete").onclick = confirmDeleteUser;

    // ====== ä¿®å¤è§’è‰²é€‰æ‹© ======
    document.querySelectorAll(".role-option").forEach((option) => {
      option.addEventListener("click", () => {
        // æ¸…é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
        document.querySelectorAll(".role-option").forEach((o) => {
          o.classList.remove("selected");
        });

        // å½“å‰é€‰ä¸­
        option.classList.add("selected");

        // å†™å…¥éšè— input
        const role = option.getAttribute("data-value");
        document.getElementById("newRole").value = role;
      });
    });
    /* ================== æ·»åŠ ç”¨æˆ·ï¼ˆå¤ç”¨æ³¨å†Œé€»è¾‘ï¼‰ ================== */
    document
      .getElementById("addUserForm")
      .addEventListener("submit", async (e) => {
        e.preventDefault();

        const username = document.getElementById("newUsername").value.trim();
        const password = document.getElementById("newPassword").value;
        const role = document.getElementById("newRole").value;

        if (!username || !password) {
          showNotification("è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ", "error");
          return;
        }

        if (password.length < 6) {
          showNotification("å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½", "error");
          return;
        }

        try {
          const res = await fetch("/api/auth/register", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              username: username,
              password: password,
              role: role,
            }),
          });

          const data = await res.json();

          if (data.success) {
            showNotification("ç”¨æˆ·æ·»åŠ æˆåŠŸ", "success");

            // é‡ç½®è¡¨å•
            document.getElementById("addUserForm").reset();

            // è§’è‰²æ¢å¤é»˜è®¤ user
            document
              .querySelectorAll(".role-option")
              .forEach((o) => o.classList.remove("selected"));

            const defaultRole = document.querySelector(
              '.role-option[data-value="user"]'
            );
            if (defaultRole) {
              defaultRole.classList.add("selected");
              document.getElementById("newRole").value = "user";
            }

            // åˆ·æ–°åˆ—è¡¨ & ç»Ÿè®¡
            loadUsers();
            loadStats();
          } else {
            showNotification(data.msg || "æ·»åŠ ç”¨æˆ·å¤±è´¥", "error");
          }
        } catch (err) {
          showNotification("è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–åç«¯æœåŠ¡", "error");
        }
      });
  }

  /* ================== åˆ é™¤ç”¨æˆ· ================== */
  function openDeleteModal(username) {
    userToDelete = username;
    document.getElementById(
      "deleteModalText"
    ).textContent = `ç¡®å®šè¦åˆ é™¤ç”¨æˆ·ã€Œ${username}ã€å—ï¼Ÿ`;
    document.getElementById("deleteModal").classList.add("active");
  }

  function closeDeleteModal() {
    userToDelete = null;
    document.getElementById("deleteModal").classList.remove("active");
  }

  async function confirmDeleteUser() {
    if (!userToDelete) return;

    const currentUser = JSON.parse(sessionStorage.getItem("currentUser"));

    try {
      const res = await fetch(`/api/auth/delete/${userToDelete}`, {
        method: "DELETE",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          admin_username: currentUser.username,
        }),
      });

      const data = await res.json();

      if (data.success) {
        showNotification("åˆ é™¤æˆåŠŸ", "success");
        closeDeleteModal();
        loadUsers();
        loadStats();
      } else {
        showNotification(data.msg || "åˆ é™¤å¤±è´¥", "error");
      }
    } catch (e) {
      showNotification("åˆ é™¤è¯·æ±‚å¤±è´¥", "error");
    }
  }

  /* ================== å·¥å…·å‡½æ•° ================== */
  function debounce(fn, delay) {
    let timer;
    return (...args) => {
      clearTimeout(timer);
      timer = setTimeout(() => fn(...args), delay);
    };
  }

  function showNotification(msg, type = "info") {
    const div = document.createElement("div");
    div.className = `notification ${type}`;
    div.textContent = msg;
    document.body.appendChild(div);

    setTimeout(() => div.classList.add("show"), 50);
    setTimeout(() => {
      div.classList.remove("show");
      setTimeout(() => div.remove(), 400);
    }, 2500);
  }
</script>
{% endblock %}
